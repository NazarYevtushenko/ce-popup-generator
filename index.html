<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OlyBet Executive Editor Pro</title>
    <style>
        :root { --accent: #1CFF47; --bg: #f4f7f6; --panel: #292935; --brand: #e32d37; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 420px; background: white; padding: 25px; box-shadow: 2px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
        
        /* Logo Styles */
        .brand-logo { width: 100%; max-width: 200px; height: auto; display: block; margin: 0 auto 20px auto; }
        
        h2 { margin-top: 0; font-size: 20px; color: var(--brand); border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        
        .import-box { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin-bottom: 20px; }
        .import-box label { color: var(--brand); font-weight: 800; }
        
        .group { margin-bottom: 12px; }
        label { display: block; font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 13px; outline: none; }
        input:focus, textarea:focus { border-color: var(--brand); }
        
        /* Upload Button Specific */
        .upload-btn { background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 10px; font-weight: bold; cursor: pointer; margin-top: 5px; width: 100%; text-transform: uppercase; transition: 0.2s; }
        .upload-btn:hover { background: #0056b3; }

        .workspace { flex-grow: 1; padding: 30px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; align-items: center; }
        .preview-area { background: #1a1a1a; border-radius: 12px; padding: 40px; display: flex; justify-content: center; align-items: center; width: 100%; max-width: 800px; min-height: 400px; box-shadow: inset 0 0 50px rgba(0,0,0,0.3); }
        
        .code-area { width: 100%; max-width: 800px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        textarea#output-code { width: 100%; height: 70px; font-family: 'Consolas', monospace; font-size: 11px; margin-top: 5px; background: #f8f9fa; border: 1px solid #eee; }
        
        .copy-btn { background: #25BD95; color: white; border: none; padding: 14px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.2s; font-size: 14px; margin-top: 5px; }
        .import-btn { background: var(--panel); color: white; border: none; padding: 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-top: 5px; width: 100%; }
        
        .team-mention { margin-top: 15px; padding: 12px; background: #fff5f5; border-radius: 10px; border: 1px dashed #e32d37; font-size: 12px; color: #444; text-align: center; }
        .heart { color: #e32d37; animation: beat .3s infinite alternate; display: inline-block; }
        @keyframes beat { to { transform: scale(1.1); } }
    </style>
</head>
<body>

<div class="sidebar">
    <img src="https://beefreefilestorage.optimove.net/images/001523/editor_images/Untitled%20design.png" alt="OlyBet Logo" class="brand-logo">
    
    <div class="sidebar-content">
        <h2>Editor Pro üöÄ</h2>
        
        <div class="import-box">
            <label>–ò–ú–ü–û–†–¢ –°–¢–ê–†–û–ì–û –ö–û–î–ê</label>
            <textarea id="import-html" style="height: 60px; margin-top: 8px;" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≥–æ—Ç–æ–≤—ã–π HTML-–∫–æ–¥ –±–∞–Ω–Ω–µ—Ä–∞..."></textarea>
            <button class="import-btn" onclick="importHTML()">–†–ê–ó–û–ë–†–ê–¢–¨ –ü–û –ü–û–õ–Ø–ú ‚Üë</button>
        </div>

        <div class="group">
            <label>Image URL</label>
            <input id="img" type="text" oninput="generate()" placeholder="Paste image link here...">
            <button class="upload-btn" onclick="window.open('https://oeg.optimove.net/#/category/One-to-One_Campaigns/templates/show/15?brandId=Obbaltics&folderId=12&typeId=8&search=&channelId=15', '_blank')">
                ‚òÅÔ∏è Upload in Optimove
            </button>
        </div>

        <div class="group"><label>Sub Headline</label><input id="sub" type="text" oninput="generate()"></div>
        <div class="group"><label>Headline</label><input id="head" type="text" oninput="generate()"></div>
        
        <div class="group">
            <label>Main Text (Ctrl+B = Bold)</label>
            <textarea id="main" oninput="generate()" style="height: 80px;"></textarea>
        </div>
        
        <div class="group"><label>Button Text</label><input id="btn" type="text" oninput="generate()"></div>
        <div class="group"><label>Link URL</label><input id="link" type="text" oninput="generate()"></div>

        <button class="copy-btn" onclick="copyCode()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ù–û–í–´–ô –ö–û–î</button>

        <div class="team-mention">
            Made with <span class="heart">‚ù§Ô∏è</span> for <br>
            <b>OlyBet Executive Team</b><br>
            <small>(Veronika, Maria, Valeria, Angelina, Kitija)</small>
        </div>
    </div>
</div>

<div class="workspace">
    <div class="preview-area" id="preview-box"></div>
    <div class="code-area">
        <label>HTML Source</label>
        <textarea id="output-code" readonly></textarea>
    </div>
</div>

<script>
    const template = `<div class="popup" style="text-align: left; display: inline-block; font-family: 'Montserrat', sans-serif; background-color: #292935; border-radius: 12px; max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); position: relative; font-size: 14px; padding: 0; overflow: hidden;"><div style="text-align: center;"><img src="[IMG LINK]" alt="Promo" style="width: 100%; height: auto; display: block;"></div><div style="padding: 25px 25px 35px 25px; color: #ffffff; text-align: left;"><p style="margin: 0 0 10px 0; font-size: 14px; color: #e0e0e0; font-weight: 600;">[SUB HEADLINE]</p><h2 style="margin: 0 0 15px 0; font-family: 'Bebas Neue Pro', sans-serif; font-size: 34px; line-height: 1.1; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; color: #ffffff;">[HEADLINE]</h2><p style="margin: 0 0 30px 0; font-size: 15px; line-height: 1.6; color: #d0d0d0;">[MAIN TEXT]</p><a href="[LINK]" target="_blank" style="text-decoration: none; display: block;"><span style="display: block; width: 100%; background: linear-gradient(90deg, #1CFF47 0%, #25BD95 100%); color: #000000; padding: 16px 0; font-weight: 800; font-family: 'Montserrat', sans-serif; font-size: 18px; border-radius: 6px; text-align: center; text-transform: uppercase; box-shadow: 0 10px 20px -5px rgba(28, 255, 71, 0.4);">[BUTTON TEXT]</span></a></div></div><style>#modal-title { display: none !important; } #modal-background { background: none !important; text-align: center; }</style>`;

    const fields = ['img', 'sub', 'head', 'main', 'btn', 'link'];
    let historyStack = [];
    let redoStack = [];
    let isProcessing = false;

    function getCurrentState() {
        const state = {};
        fields.forEach(id => {
            state[id] = document.getElementById(id).value;
        });
        return JSON.stringify(state);
    }

    function saveState() {
        if (isProcessing) return;
        const currentState = getCurrentState();
        const lastState = historyStack.length > 0 ? JSON.stringify(historyStack[historyStack.length - 1]) : null;

        if (currentState !== lastState) {
            historyStack.push(JSON.parse(currentState));
            redoStack = []; 
            if (historyStack.length > 50) historyStack.shift();
        }
    }

    function applyState(state) {
        if (!state) return;
        isProcessing = true;
        fields.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = state[id] || "";
        });
        generate(true);
        isProcessing = false;
    }

    function undo() {
        if (historyStack.length > 1) {
            redoStack.push(historyStack.pop());
            applyState(historyStack[historyStack.length - 1]);
        }
    }

    function redo() {
        if (redoStack.length > 0) {
            const state = redoStack.pop();
            historyStack.push(state);
            applyState(state);
        }
    }

    function importHTML() {
        const raw = document.getElementById('import-html').value;
        if (!raw) return alert("–°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥!");
        const parser = new DOMParser();
        const doc = parser.parseFromString(raw, 'text/html');
        try {
            isProcessing = true;
            document.getElementById('img').value = doc.querySelector('img')?.getAttribute('src') || "";
            document.getElementById('sub').value = doc.querySelector('p[style*="font-weight: 600"]')?.innerText || "";
            document.getElementById('head').value = doc.querySelector('h2')?.innerText || "";
            let mainHtml = doc.querySelector('p[style*="line-height: 1.6"]')?.innerHTML || "";
            document.getElementById('main').value = mainHtml.replace(/<br\s*[\/]?>/gi, "\n").trim();
            document.getElementById('btn').value = doc.querySelector('span[style*="text-transform: uppercase"]')?.innerText || "";
            let linkElement = doc.querySelector('a');
            document.getElementById('link').value = linkElement ? linkElement.getAttribute('href') : "";
            isProcessing = false;
            saveState();
            generate();
            alert("–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!");
        } catch (e) {
            isProcessing = false;
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ –∫–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.");
        }
    }

    window.addEventListener('keydown', function(e) {
        const isCmdOrCtrl = e.ctrlKey || e.metaKey;
        if (isCmdOrCtrl && e.code === 'KeyZ' && !e.shiftKey) {
            e.preventDefault();
            undo();
        }
        if (isCmdOrCtrl && (e.code === 'KeyY' || (e.code === 'KeyZ' && e.shiftKey))) {
            e.preventDefault();
            redo();
        }
        if (isCmdOrCtrl && e.code === 'KeyB' && document.activeElement.id === 'main') {
            e.preventDefault();
            applyBold();
        }
    });

    function applyBold() {
        const el = document.getElementById('main');
        const start = el.selectionStart, end = el.selectionEnd, text = el.value;
        if (start === end) return;
        el.value = text.substring(0, start) + '<strong>' + text.substring(start, end) + '</strong>' + text.substring(end);
        el.focus();
        el.selectionStart = start + 8; el.selectionEnd = end + 8;
        saveState();
        generate();
    }

    function generate(skipHistory = false) {
        const rawMainText = document.getElementById('main').value;
        const formattedMainText = rawMainText.replace(/\n/g, '<br>') || 'Description...';
        let res = template
            .replaceAll("[IMG LINK]", document.getElementById('img').value || 'https://via.placeholder.com/400x200/292935/ffffff?text=OlyBet+Promo')
            .replaceAll("[SUB HEADLINE]", document.getElementById('sub').value || 'SUB HEADLINE')
            .replaceAll("[HEADLINE]", document.getElementById('head').value || 'MAIN HEADLINE')
            .replaceAll("[MAIN TEXT]", formattedMainText)
            .replaceAll("[BUTTON TEXT]", document.getElementById('btn').value || 'JOIN NOW')
            .replaceAll("[LINK]", document.getElementById('link').value || '#');
        document.getElementById('output-code').value = res;
        document.getElementById('preview-box').innerHTML = res;
        if (!isProcessing && !skipHistory) {
            clearTimeout(window.saveTimeout);
            window.saveTimeout = setTimeout(saveState, 500);
        }
    }

    function copyCode() {
        const out = document.getElementById("output-code");
        out.select();
        document.execCommand("copy");
        const btn = document.querySelector('.copy-btn');
        btn.innerText = "–£–°–ü–ï–®–ù–û –°–ö–û–ü–ò–†–û–í–ê–ù–û!";
        setTimeout(() => { btn.innerText = "–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ù–û–í–´–ô –ö–û–î"; }, 1500);
    }

    window.onload = () => {
        saveState();
        generate();
    };
</script>
</body>
</html>


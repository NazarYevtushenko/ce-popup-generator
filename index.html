<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OlyBet Executive Editor Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --accent: #1CFF47; --bg: #f4f7f6; --panel: #292935; --brand: #e32d37; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 420px; background: white; padding: 25px; box-shadow: 2px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
        
        .brand-logo { width: 100%; max-width: 200px; height: auto; display: block; margin: 0 auto 20px auto; }
        h2 { margin-top: 0; font-size: 20px; color: var(--brand); border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        
        /* –û–±—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ */
        .assets-container { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; margin-bottom: 20px; }
        .assets-grid { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; min-height: 50px; }
        .asset-item { width: 45px; height: 45px; background: #292935; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 9px; font-weight: bold; text-align: center; overflow: hidden; border: 2px solid transparent; transition: 0.2s; position: relative; }
        .asset-item:hover { border-color: var(--accent); transform: scale(1.05); }
        .asset-item img { width: 100%; height: 100%; object-fit: contain; }

        .import-box { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin-bottom: 20px; }
        .group { margin-bottom: 12px; }
        label { display: block; font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 13px; outline: none; }
        
        .checkbox-group { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer; }
        .checkbox-group input { width: auto; }

        .upload-btn { background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 10px; font-weight: bold; cursor: pointer; margin-top: 5px; width: 100%; text-transform: uppercase; }
        .copy-btn { background: #25BD95; color: white; border: none; padding: 14px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.2s; font-size: 14px; margin-top: 5px; }
        .import-btn { background: var(--panel); color: white; border: none; padding: 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-top: 5px; width: 100%; }
        
        .workspace { flex-grow: 1; padding: 30px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; align-items: center; }
        .preview-area { background: #1a1a1a; border-radius: 12px; padding: 40px; display: flex; justify-content: center; align-items: center; width: 100%; max-width: 800px; min-height: 400px; box-shadow: inset 0 0 50px rgba(0,0,0,0.3); }
        .code-area { width: 100%; max-width: 800px; background: white; padding: 15px; border-radius: 12px; }
        textarea#output-code { width: 100%; height: 70px; font-family: 'Consolas', monospace; font-size: 11px; background: #f8f9fa; border: 1px solid #eee; }
        
        .team-mention { margin-top: 15px; padding: 12px; background: #fff5f5; border-radius: 10px; border: 1px dashed #e32d37; font-size: 12px; color: #444; text-align: center; }
        .heart { color: #e32d37; animation: beat .3s infinite alternate; display: inline-block; }
        @keyframes beat { to { transform: scale(1.1); } }
    </style>
</head>
<body>

<div class="sidebar">
    <img src="https://beefreefilestorage.optimove.net/images/001523/editor_images/Untitled%20design.png" alt="OlyBet Logo" class="brand-logo">
    
    <div class="sidebar-content">
        <h2>Editor Pro üöÄ</h2>

        <div class="assets-container">
            <label style="color: #0369a1;">‚òÅÔ∏è –û–ë–©–ê–Ø –ë–ò–ë–õ–ò–û–¢–ï–ö–ê (Executive Team)</label>
            <div id="assets-grid" class="assets-grid"></div>
            <div style="display: flex; gap: 5px; margin-top: 10px;">
                <input id="asset-name" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (UCL, Euro...)" style="padding: 5px; font-size: 11px;">
                <button onclick="addAssetToCloud()" class="upload-btn" style="width: 40px; margin:0; background:#28a745;">+</button>
            </div>
            <div style="font-size: 9px; color: #666; margin-top: 5px;">* –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –ø–æ –∏–∫–æ–Ω–∫–µ, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —É –≤—Å–µ—Ö</div>
        </div>
        
        <div class="import-box">
            <label>–ò–ú–ü–û–†–¢ –°–¢–ê–†–û–ì–û –ö–û–î–ê</label>
            <textarea id="import-html" style="height: 60px; margin-top: 8px;" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≥–æ—Ç–æ–≤—ã–π HTML-–∫–æ–¥..."></textarea>
            <button class="import-btn" onclick="importHTML()">–†–ê–ó–û–ë–†–ê–¢–¨ –ü–û –ü–û–õ–Ø–ú ‚Üë</button>
        </div>

        <div class="group">
            <label>Image URL</label>
            <input id="img" type="text" oninput="generate()" placeholder="Paste image link here...">
            <button class="upload-btn" onclick="window.open('https://obbaltics.optimove.net/#/category/One-to-One_Campaigns/templates/optimail?brandId=Olybet&folderId=2&typeId=7&templateId=1263&onlyedit=true', '_blank')">
                ‚òÅÔ∏è Upload in Optimove
            </button>
        </div>

        <div class="group"><label>Sub Headline</label><input id="sub" type="text" oninput="generate()"></div>
        <div class="group"><label>Headline</label><input id="head" type="text" oninput="generate()"></div>
        
        <div class="group">
            <label>Main Text (Ctrl+B = Bold)</label>
            <textarea id="main" oninput="generate()" style="height: 80px;"></textarea>
        </div>
        
        <div class="group">
            <label class="checkbox-group">
                <input type="checkbox" id="cta-toggle" checked onchange="generate()">
                <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É (Link & CTA)</span>
            </label>
            <label>Button Text</label>
            <input id="btn" type="text" oninput="generate()">
        </div>
        
        <div class="group">
            <label>Link URL</label>
            <input id="link" type="text" oninput="generate()">
        </div>

        <button class="copy-btn" onclick="copyCode()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ù–û–í–´–ô –ö–û–î</button>

        <div class="team-mention">
            Made with <span class="heart">‚ù§Ô∏è</span> for <br>
            <b>OlyBet Executive Team</b><br>
            <small>(Veronika, Maria, Valeria, Angelina, Kitija)</small>
        </div>
    </div>
</div>

<div class="workspace">
    <div class="preview-area" id="preview-box"></div>
    <div class="code-area">
        <label>HTML Source</label>
        <textarea id="output-code" readonly></textarea>
    </div>
</div>

<script>
    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyAPU-R6OJIAVtem_hJVJ4ZnjxFk_tpGBvs",
        authDomain: "optimoveassets.firebaseapp.com",
        databaseURL: "https://optimoveassets-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "optimoveassets",
        storageBucket: "optimoveassets.firebasestorage.app",
        messagingSenderId: "523129202709",
        appId: "1:523129202709:web:d67269418d280ceaf3461c",
        measurementId: "G-B7PKKJ167E"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const assetsRef = database.ref('shared_assets');

    // –®–∞–±–ª–æ–Ω—ã
    const template = `<div class="popup" style="text-align: left; display: inline-block; font-family: 'Montserrat', sans-serif; background-color: #292935; border-radius: 12px; max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); position: relative; font-size: 14px; padding: 0; overflow: hidden;"><div style="text-align: center;"><img src="[IMG LINK]" alt="Promo" style="width: 100%; height: auto; display: block;"></div><div style="padding: 25px 25px 35px 25px; color: #ffffff; text-align: left;"><p style="margin: 0 0 10px 0; font-size: 14px; color: #e0e0e0; font-weight: 600;">[SUB HEADLINE]</p><h2 style="margin: 0 0 15px 0; font-family: 'Bebas Neue Pro', sans-serif; font-size: 34px; line-height: 1.1; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; color: #ffffff;">[HEADLINE]</h2><p style="margin: 0 0 30px 0; font-size: 15px; line-height: 1.6; color: #d0d0d0;">[MAIN TEXT]</p>[CTA_BLOCK]</div></div><style>#modal-title { display: none !important; } #modal-background { background: none !important; text-align: center; }</style>`;
    const ctaSubTemplate = `<a href="[LINK]" target="_blank" style="text-decoration: none; display: block;"><span style="display: block; width: 100%; background: linear-gradient(90deg, #1CFF47 0%, #25BD95 100%); color: #000000; padding: 16px 0; font-weight: 800; font-family: 'Montserrat', sans-serif; font-size: 18px; border-radius: 6px; text-align: center; text-transform: uppercase; box-shadow: 0 10px 20px -5px rgba(28, 255, 71, 0.4);">[BUTTON TEXT]</span></a>`;

    const fields = ['img', 'sub', 'head', 'main', 'btn', 'link'];
    let historyStack = [];
    let isProcessing = false;

    // --- –õ–û–ì–ò–ö–ê –û–ë–õ–ê–ß–ù–û–ô –ë–ò–ë–õ–ò–û–¢–ï–ö–ò ---
    function loadSharedAssets() {
        assetsRef.on('value', (snapshot) => {
            const grid = document.getElementById('assets-grid');
            const data = snapshot.val();
            grid.innerHTML = '';
            if (data) {
                Object.keys(data).forEach(key => {
                    const item = data[key];
                    const div = document.createElement('div');
                    div.className = 'asset-item';
                    div.title = item.name;
                    div.innerHTML = item.url.match(/\.(jpg|jpeg|png|gif|webp)$/i) ? `<img src="${item.url}">` : `<span>${item.name}</span>`;
                    div.onclick = () => { document.getElementById('img').value = item.url; generate(); };
                    div.oncontextmenu = (e) => { e.preventDefault(); if(confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑ –æ–±—â–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏?')) assetsRef.child(key).remove(); };
                    grid.appendChild(div);
                });
            }
        });
    }

    function addAssetToCloud() {
        const url = document.getElementById('img').value;
        const name = document.getElementById('asset-name').value || 'Asset';
        if (url) {
            assetsRef.push({ name, url });
            document.getElementById('asset-name').value = '';
        } else {
            alert("–°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ –ø–æ–ª–µ Image URL");
        }
    }

    // --- –õ–û–ì–ò–ö–ê –†–ï–î–ê–ö–¢–û–†–ê ---
    function saveState() {
        if (isProcessing) return;
        const state = {};
        fields.forEach(id => state[id] = document.getElementById(id).value);
        state.cta = document.getElementById('cta-toggle').checked;
        if (JSON.stringify(state) !== JSON.stringify(historyStack[historyStack.length-1])) {
            historyStack.push(state);
            if (historyStack.length > 50) historyStack.shift();
        }
    }

    function undo() {
        if (historyStack.length > 1) {
            historyStack.pop();
            const last = historyStack[historyStack.length-1];
            isProcessing = true;
            fields.forEach(id => document.getElementById(id).value = last[id]);
            document.getElementById('cta-toggle').checked = last.cta;
            generate(true);
            isProcessing = false;
        }
    }

    function importHTML() {
        const raw = document.getElementById('import-html').value;
        if (!raw) return;
        const doc = new DOMParser().parseFromString(raw, 'text/html');
        try {
            isProcessing = true;
            document.getElementById('img').value = doc.querySelector('img')?.getAttribute('src') || "";
            document.getElementById('sub').value = doc.querySelector('p[style*="font-weight: 600"]')?.innerText || "";
            document.getElementById('head').value = doc.querySelector('h2')?.innerText || "";
            document.getElementById('main').value = (doc.querySelector('p[style*="line-height: 1.6"]')?.innerHTML || "").replace(/<br\s*[\/]?>/gi, "\n").trim();
            const btn = doc.querySelector('span[style*="text-transform: uppercase"]');
            const link = doc.querySelector('a');
            document.getElementById('cta-toggle').checked = !!(btn || link);
            document.getElementById('btn').value = btn?.innerText || "";
            document.getElementById('link').value = link?.getAttribute('href') || "";
            isProcessing = false;
            saveState();
            generate();
        } catch(e) { alert("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞"); isProcessing = false; }
    }

    window.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && e.code === 'KeyZ') { e.preventDefault(); undo(); }
        if ((e.ctrlKey || e.metaKey) && e.code === 'KeyB' && document.activeElement.id === 'main') {
            e.preventDefault();
            const el = document.getElementById('main');
            const s = el.selectionStart, end = el.selectionEnd, txt = el.value;
            el.value = txt.substring(0, s) + '<strong>' + txt.substring(s, end) + '</strong>' + txt.substring(end);
            generate();
        }
    });

    function generate(skipHistory = false) {
        const ctaEnabled = document.getElementById('cta-toggle').checked;
        let ctaHtml = ctaEnabled ? ctaSubTemplate.replaceAll("[LINK]", document.getElementById('link').value || '#').replaceAll("[BUTTON TEXT]", document.getElementById('btn').value || 'JOIN NOW') : "";
        
        let res = template
            .replaceAll("[IMG LINK]", document.getElementById('img').value || 'https://via.placeholder.com/400x200/292935/ffffff?text=OlyBet+Promo')
            .replaceAll("[SUB HEADLINE]", document.getElementById('sub').value || 'SUB HEADLINE')
            .replaceAll("[HEADLINE]", document.getElementById('head').value || 'MAIN HEADLINE')
            .replaceAll("[MAIN TEXT]", document.getElementById('main').value.replace(/\n/g, '<br>') || 'Description...')
            .replaceAll("[CTA_BLOCK]", ctaHtml);

        document.getElementById('output-code').value = res;
        document.getElementById('preview-box').innerHTML = res;
        if (!isProcessing && !skipHistory) {
            clearTimeout(window.saveTimeout);
            window.saveTimeout = setTimeout(saveState, 500);
        }
    }

    function copyCode() {
        const out = document.getElementById("output-code");
        out.select();
        document.execCommand("copy");
        document.querySelector('.copy-btn').innerText = "–£–°–ü–ï–®–ù–û –°–ö–û–ü–ò–†–û–í–ê–ù–û!";
        setTimeout(() => { document.querySelector('.copy-btn').innerText = "–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ù–û–í–´–ô –ö–û–î"; }, 1500);
    }

    window.onload = () => { loadSharedAssets(); generate(); };
</script>
</body>
</html>
